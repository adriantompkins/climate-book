

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>EOF analysis &#8212; Earth System Modelling</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/part2_cda/climdata_EOF1';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Larvae-Vector System: Stability Analysis and Temperature Dependence" href="climdata_linear_stability_analysis.html" />
    <link rel="prev" title="Introduction to DDT analysis" href="climdata_FFT_analysis.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Earth System Modelling</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Atmospheric Physics and Data Analysis
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Thermodynamics and Physics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../markdown/content_radiation.html">Energy Balance and Forcing</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../part1_tpa/radn_orbital.html">Orbital variations, insolation, and the ice ages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../part1_tpa/radn_insolation.html">Insolation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../part1_tpa/radn_radeq.html">Radiative Equilibrium</a></li>
<li class="toctree-l2"><a class="reference internal" href="../part1_tpa/radn_rce.html">Radiative-Convective Equilibrium</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Climate Data Analysis</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../../markdown/content_clima_data.html">Climate data analysis</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="climdata_trends_timeseries.html">Trend derivation</a></li>


<li class="toctree-l2"><a class="reference internal" href="climdata_breakpoint_analysis.html">Breakpoint analysis (segmentation analysis)</a></li>





<li class="toctree-l2"><a class="reference internal" href="climdata_gpgp_indices.html">Rainfall indices based on the Indian monsoon</a></li>





<li class="toctree-l2"><a class="reference internal" href="climdata_correlation_covariance.html">Correlation and Covariance</a></li>





<li class="toctree-l2"><a class="reference internal" href="climdata_FFT_analysis.html">Introduction to DDT analysis</a></li>

<li class="toctree-l2 current active"><a class="current reference internal" href="#">EOF analysis</a></li>



<li class="toctree-l2"><a class="reference internal" href="climdata_linear_stability_analysis.html">Larvae-Vector System: Stability Analysis and Temperature Dependence</a></li>



</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../markdown/content_modelling.html">Earth System modelling</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="mod_advection.html">Focus on advection</a></li>
<li class="toctree-l2"><a class="reference internal" href="mod_CMIP_IPCC_temperature_trends.html">Coupled Model Intercomparison Project (CMIP)</a></li>

<li class="toctree-l2"><a class="reference internal" href="mod_climate-system-models.html">The climate system and climate models</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/adriantompkins/climate-book.git/master?urlpath=tree/notebooks/part2_cda/climdata_EOF1.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/adriantompkins/climate-book.git/blob/master/notebooks/part2_cda/climdata_EOF1.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/adriantompkins/climate-book.git" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/adriantompkins/climate-book.git/issues/new?title=Issue%20on%20page%20%2Fnotebooks/part2_cda/climdata_EOF1.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/part2_cda/climdata_EOF1.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>EOF analysis</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">EOF analysis</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#first-a-few-notes-on-terminology">First, a few notes on terminology:</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#maximizing-the-resemblance-of-e-1-onto-x-eigenanalysis-of-c">Maximizing the resemblance of <span class="math notranslate nohighlight">\(e_1\)</span> onto X = Eigenanalysis of C!</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-points">Key Points:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-remove-the-mean">Step 1: Remove the mean</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-standardizing-the-data-optional">Step 2: Standardizing the data (optional)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-weighting-gridded-data">Step 3: Weighting gridded data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-convert-3d-array-to-2d-matrix">Step 4: Convert 3D array to 2D matrix</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-5-calculate-the-covariance-matrix">Step 5: Calculate the covariance matrix</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-6-perform-eigenanalysis-of-the-covariance-matrix">Step 6: Perform eigenanalysis of the covariance matrix</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#presenting-eofs-pcs">Presenting EOFs/PCs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-many-eofs-pcs-are-meaningful">How many EOFs/PCs are meaningful?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multivariate-eof-analysis">Multivariate EOF analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#caveat-on-modes">Caveat on modes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eofs-in-cdo-climate-data-analysis">EOFs  in CDO (climate data analysis)</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="eof-analysis">
<h1>EOF analysis<a class="headerlink" href="#eof-analysis" title="Permalink to this heading">#</a></h1>
<p>First of all, an acknowdlegment: I have borrowed <em>very</em> heavily for this lesson from the excellent material of Karen Smith,
found here: <a class="reference external" href="https://kls2177.github.io/Climate-and-Geophysical-Data-Analysis/">https://kls2177.github.io/Climate-and-Geophysical-Data-Analysis/</a></p>
<p>I also recommend her book for background reading on the FFT and regression analysis that we covered.</p>
<section id="first-a-few-notes-on-terminology">
<h2>First, a few notes on terminology:<a class="headerlink" href="#first-a-few-notes-on-terminology" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>EOF stands for Empirical Orthogonal Functions</p></li>
<li><p>PCA stands for Principal Component Analysis</p></li>
<li><p>EOF analysis and PCA are practically the same thing</p></li>
<li><p>PCA is the more generally used term, and just implies converting a matrix into sets of linearly uncorrelated variables, called principle components.</p></li>
<li><p>EOF analysis normally refers to finding the principle components that maximize the variance explained (i.e., a subset of all PC’s)</p></li>
</ul>
<p>Say we have a data matrix <span class="math notranslate nohighlight">\(X\)</span> which is a function of time and space <span class="math notranslate nohighlight">\(X[t,s]\)</span>, for now, let the rows denote different times and the columns different spatial locations (although this is not required for the actual application).
In use, we often apply the technique to 2D data often, that is a function of x and y, i.e. <span class="math notranslate nohighlight">\(X=X[t,lon,lat]\)</span>, but that is essentially the same; just imagine taking all the lat/lon points and lining them up in a huge, long vector!</p>
<p>The goal of EOF analysis is to decompose <span class="math notranslate nohighlight">\(X\)</span> into a set of spatial patterns, i.e, <em>orthogonal</em> eigenvectors, <span class="math notranslate nohighlight">\(e_i\)</span>’s, that explain the most variance of <span class="math notranslate nohighlight">\(X\)</span>. In other words, we want to maximize the resemblance of <span class="math notranslate nohighlight">\(e_i\)</span> (which has dimention of <span class="math notranslate nohighlight">\(nlon*nlat\)</span> spatial dimension) to the data, that is, find the <span class="math notranslate nohighlight">\(e_1\)</span> vector that explains the most variance.</p>
<p>The figure provides a visualization of what we are trying to accomplish. <span class="math notranslate nohighlight">\(X\)</span> is a data matrix consisting of sea-level pressure (SLP) in mb at
<span class="math notranslate nohighlight">\(N\)</span> points in space and
<span class="math notranslate nohighlight">\(M\)</span> points in time.</p>
<p><img alt="EOF" src="https://kls2177.github.io/Climate-and-Geophysical-Data-Analysis/_images/eofs.png" /></p>
<p>The first eigenvector <span class="math notranslate nohighlight">\(e_1\)</span> shows the pattern that explains the most variance in <span class="math notranslate nohighlight">\(X\)</span>. Note that just like the unit eigenvectors of 2-D or 3-D space, where <span class="math notranslate nohighlight">\(e_1=(1,0)\)</span> or <span class="math notranslate nohighlight">\((-1,0)\)</span> are legitimate eigenvectors, the <span class="math notranslate nohighlight">\(e_1\)</span>
describing the variance of <span class="math notranslate nohighlight">\(X\)</span> can look like the pattern in the Figure or it can look like -1 x this pattern. I.e. PCA analysis produces an arbitrary sign in the patterns.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="maximizing-the-resemblance-of-e-1-onto-x-eigenanalysis-of-c">
<h1>Maximizing the resemblance of <span class="math notranslate nohighlight">\(e_1\)</span> onto X = Eigenanalysis of C!<a class="headerlink" href="#maximizing-the-resemblance-of-e-1-onto-x-eigenanalysis-of-c" title="Permalink to this heading">#</a></h1>
<p>The resemblance of <span class="math notranslate nohighlight">\(e_1\)</span> the to the data, <span class="math notranslate nohighlight">\(X\)</span>, is measured by the inner product of
<span class="math notranslate nohighlight">\(e_1\)</span> with <span class="math notranslate nohighlight">\(X\)</span> (this is also called the projection of <span class="math notranslate nohighlight">\(e_1\)</span>
onto <span class="math notranslate nohighlight">\(X\)</span>).</p>
<p>If we want to maximize this resemblance, there are a few steps that we should take:</p>
<ul class="simple">
<li><p>we should square the resemblance to ensure that positive and negative resemblances are counted the same (as in the case of linear regression where we square the errors).</p></li>
<li><p>we should normalize the eigenvector, <span class="math notranslate nohighlight">\(e_1\)</span> to have unit length to make the resemblance independent of the magnitude of
<span class="math notranslate nohighlight">\(e_1\)</span>.</p></li>
</ul>
<p>If one follows these rules, the resemblance of
to the data turns out to be:</p>
<div class="math notranslate nohighlight">
\[(Xe_1)^2 = e_1^T X^T X e_1\]</div>
<p>If <span class="math notranslate nohighlight">\(e_1\)</span> is a unit vector then the aim of finding the e_1 with the maximum variance  is the same as the task of maximizing</p>
<div class="math notranslate nohighlight">
\[ e_1^T C e_1\]</div>
<p>If that maximum resemblance equals <span class="math notranslate nohighlight">\(\lambda_1\)</span>
then we can write</p>
<div class="math notranslate nohighlight">
\[ e_1^T C e_1=\lambda_1\]</div>
<p>which we recognise straight away as an eigenvalue problem, as it can written</p>
<div class="math notranslate nohighlight">
\[ e e_1^T C e_1= e\lambda_1\]</div>
<p>thus</p>
<div class="math notranslate nohighlight">
\[C e_1=\lambda_1 e_1\]</div>
<p>Thus <span class="math notranslate nohighlight">\(e_1\)</span> must be an eigenvector of <span class="math notranslate nohighlight">\(C\)</span> with corresponding eigenvalue <span class="math notranslate nohighlight">\(\lambda_1\)</span>. Hence, we can find
by “eigenanalyzing” C.</p>
<section id="key-points">
<h2>Key Points:<a class="headerlink" href="#key-points" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>The 1st eigenvector corresponds to the vector that explains the most variance in <span class="math notranslate nohighlight">\(X\)</span> and has the largest eigenvalue</p></li>
<li><p>The 2nd eigenvector corresponds to the vector that explains the second most variance in <span class="math notranslate nohighlight">\(X\)</span> and has the 2nd largest eigenvalue</p></li>
<li><p>The eigenanalysis of the covariance matrix transforms C into a different coordinate system where the “new” matrix is diagonal (
).</p></li>
<li><p>In this new coordinate space, all of the variance is along the diagonal since the different vectors are orthogonal. Thus, the fraction of variance explained by the j<span class="math notranslate nohighlight">\(^{th}\)</span> eigenvector is the corresponding eigenvalue
divided by the sum of all of the eigenvalues, that is</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\lambda_j / \sum \lambda_i\)</span></p>
<p>Typically, EOFs are ordered by their corresponding <span class="math notranslate nohighlight">\(\lambda_i\)</span>
, such that EOF 1 explains the largest variance (largest
) and the last EOF (typically the
th EOF) has the smallest.</p>
<p>No other linear combination of <span class="math notranslate nohighlight">\(n\)</span>
predictors can explain a larger fraction of the variance than the first <span class="math notranslate nohighlight">\(n\)</span>
EOF/PC’s!</p>
<p>Remember also that the patterns (EOFs) are orthogonal, i.e. their dot product is zero.</p>
<p>The principal component time series, Z, are equivalent to mapping X into the new vector space spanned by the eigenvectors. We can do this by performing a linear transformation of X.</p>
<p><img alt="PC and EOF" src="https://kls2177.github.io/Climate-and-Geophysical-Data-Analysis/_images/pc_ts.png" /></p>
<p>Let’s build up a EOF analysis by scratch… First we need these packages:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">cartopy.feature</span> <span class="k">as</span> <span class="nn">cfeature</span>
<span class="kn">from</span> <span class="nn">matplotlib.animation</span> <span class="kn">import</span> <span class="n">FuncAnimation</span><span class="p">,</span> <span class="n">PillowWriter</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">datadir</span><span class="o">=</span><span class="s2">&quot;/Users/tompkins/DATA/era5/monthly/nc/&quot;</span>
<span class="n">file</span><span class="o">=</span><span class="n">datadir</span><span class="o">+</span><span class="s2">&quot;total_precip.nc&quot;</span>

<span class="c1">#datadir=&quot;http://clima-dods.ictp.it/Users/tompkins/diploma/data/&quot;</span>
<span class="c1">#file=datadir+&quot;total_precip.nc&quot;+&quot;#mode=bytes&quot;</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="n">precip</span><span class="o">=</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;tp&quot;</span><span class="p">]</span><span class="o">*</span><span class="mi">24000</span>
<span class="n">lat</span><span class="o">=</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">]</span>
<span class="n">lon</span><span class="o">=</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;lon&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-1-remove-the-mean">
<h2>Step 1: Remove the mean<a class="headerlink" href="#step-1-remove-the-mean" title="Permalink to this heading">#</a></h2>
<p>It is typical to remove the sampling dimension mean, which is usually the time dimension. This will result in your principal component time series having a mean of zero. You may also want to remove the seasonal or diurnal cycle if this is not of interest to you.</p>
<p>It is less common to remove the spatial mean. For example, suppose you are interested in the gradients in temperature, not the full temperature field itself or you are interested in the “wavy” component of the field, so you might remove the zonal mean.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  Calculate the time mean for each grid point (lon, lat).</span>
<span class="n">precip_mean</span> <span class="o">=</span> <span class="n">precip</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
<span class="n">precip_std</span> <span class="o">=</span> <span class="n">precip</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

<span class="c1">#  Subtract the time mean from the original data.</span>
<span class="n">precip_anom_real</span> <span class="o">=</span> <span class="p">(</span><span class="n">precip</span> <span class="o">-</span> <span class="n">precip_mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="step-2-standardizing-the-data-optional">
<h1>Step 2: Standardizing the data (optional)<a class="headerlink" href="#step-2-standardizing-the-data-optional" title="Permalink to this heading">#</a></h1>
<p>Sometimes, it is desirable to take the amplitude of the variability out of the data before doing EOF analysis. For example, you may want to do this if</p>
<p>your data is made of a combination of parameters with different units, and you don’t want the parameter with the biggest units to dominate the variance</p>
<p>if the variance of the data varies greatly in space (and this is not of interest to you)</p>
<p>In order to do this, you divide your anomaly data by its standard deviation as well (now your data is in units of
). For the rainfall example, we will not standardize the data as we are interested in capturing the spatial the magnitude of the variability.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### if commented out you can try to include this </span>
<span class="c1"># precip_anom_real/=precip_std</span>
</pre></div>
</div>
</div>
</div>
<section id="step-3-weighting-gridded-data">
<h2>Step 3: Weighting gridded data<a class="headerlink" href="#step-3-weighting-gridded-data" title="Permalink to this heading">#</a></h2>
<p>If the data is gridded, you need to weight the data according to the grid box area. For example, if the data is on a rectangular grid on a sphere (like in our example), the size of the grid boxes decreases as you move from the equator to the poles.</p>
<p>if you are calculating EOFs using the covariance matrix and you are analyzing the temporal covariance matrix (as here, and often the case) then we need to weigh by the <span class="math notranslate nohighlight">\(\sqrt{(cos(lat))}\)</span>, because the covariance matrix is <span class="math notranslate nohighlight">\(XX^T\)</span>.</p>
<p>Note that the resulting EOFs will look unphysical and have unphysical values, this will be remedied when we discuss how to present EOFs (see below).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Convert latitude to radians.  Use .to_numpy() to ensure a numpy array</span>
<span class="c1"># for the cosine calculation, in case lat is a dask array.</span>
<span class="n">lat_rad</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span>

<span class="c1"># 2. Calculate the cosine weight.  Use np.sqrt for the square root</span>
<span class="n">cos_wgt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat_rad</span><span class="p">))</span>

<span class="c1"># 3. Apply the weighting.  Xarray will automatically broadcast cos_wgt</span>
<span class="c1">#    to match the dimensions of da.  This is the key to avoiding loops.</span>
<span class="n">precip_anom</span><span class="o">=</span><span class="n">precip_anom_real</span><span class="o">*</span><span class="n">cos_wgt</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-4-convert-3d-array-to-2d-matrix">
<h2>Step 4: Convert 3D array to 2D matrix<a class="headerlink" href="#step-4-convert-3d-array-to-2d-matrix" title="Permalink to this heading">#</a></h2>
<p>The next step is to convert our 3D array into a 2D matrix, so that we can perform matrix operations, specifically so that we c</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 4. Reshape the data to (ntime, nlon*nlat)</span>
<span class="c1"># Get the dimensions *before* reshaping</span>
<span class="c1"># 2. Extract dimensions</span>
<span class="n">ntime</span><span class="p">,</span> <span class="n">nlat</span><span class="p">,</span> <span class="n">nlon</span> <span class="o">=</span> <span class="n">precip_anom</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">precip_anom</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="n">precip_anom</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span>
<span class="n">precip_reshape</span> <span class="o">=</span> <span class="n">precip_anom</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ntime</span><span class="p">,</span><span class="n">nlon</span> <span class="o">*</span> <span class="n">nlat</span><span class="p">)</span>
<span class="n">precip_anom</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
            <span class="n">precip_reshape</span><span class="p">,</span>
            <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;space&#39;</span><span class="p">],</span>
            <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">precip_anom</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]}</span>  <span class="c1"># Keep time coord</span>
        <span class="p">)</span>


<span class="n">precip_anom</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(138, 347040)
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-5-calculate-the-covariance-matrix">
<h2>Step 5: Calculate the covariance matrix<a class="headerlink" href="#step-5-calculate-the-covariance-matrix" title="Permalink to this heading">#</a></h2>
<p>Our data is now ready for us to calculate the covariance matrix. Remember that we are going to calculate the temporal covariance matrix due to the slow computation speed associated with calculating the spatial dispersion matrix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate the covariance matrix</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">precip_anom</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(138, 138)
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-6-perform-eigenanalysis-of-the-covariance-matrix">
<h2>Step 6: Perform eigenanalysis of the covariance matrix<a class="headerlink" href="#step-6-perform-eigenanalysis-of-the-covariance-matrix" title="Permalink to this heading">#</a></h2>
<p>The next step is the eigenanalysis. Note that because we are eigenanalyzing the temporal covariance matrix,
the  eigenvectors correspond to the <strong>principal component time series</strong> and we will calculate the spatial patterns, the EOFs, by performing a linear transformation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># eigenanalyze C</span>
<span class="c1"># LAM=Lambda eigenvalues, </span>
<span class="c1"># which give us the explained variance </span>
<span class="c1">#</span>
<span class="c1"># E=eigenvectors, the Principle Components (PCs)...</span>
<span class="n">LAM</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s take a look at the shape of the eigenvectors, what do we expect?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">E</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(138, 138)
</pre></div>
</div>
</div>
</div>
<p>The result is a square matrix, with the first axis representing time, and the second is the PC number.
Thus the first PC1 which will correspond to the first pattern, is stored in <code class="docutils literal notranslate"><span class="pre">E[:,0]</span></code></p>
<p>We can now extract that pattern by projecting the weighted data matrix onto the PC time series, as this is what was used to calculate the covariance matrix.</p>
<p>We can do this by taking the dot product of the original field and the pc1:</p>
<p><code class="docutils literal notranslate"><span class="pre">np.dot(precip_anom.T,pc1)</span></code></p>
<p>Thus any variable that covaries with the PC will end up with a signal in the resulting dot product field.</p>
<p><strong>NOTE</strong> We could apply this dot product to any other field to note how it co-varies with the index, but first it is better to normalize the PC series, which we will return to later</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># number of EOF we want to analyse:</span>
<span class="n">neof</span><span class="o">=</span><span class="mi">5</span> 

<span class="c1"># empty list </span>
<span class="n">eof_da</span><span class="o">=</span><span class="p">[]</span>
<span class="n">pc_da</span><span class="o">=</span><span class="p">[]</span>

<span class="k">for</span> <span class="n">ieof</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">neof</span><span class="p">):</span>
    <span class="c1"># compute the 1st EOF</span>
    <span class="c1"># the EOFs are computed by projecting the data matrix onto the PC time series</span>
    <span class="n">EOF</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">precip_anom</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">E</span><span class="p">[:,</span><span class="n">ieof</span><span class="p">]),</span> <span class="p">(</span><span class="n">nlat</span><span class="p">,</span><span class="n">nlon</span><span class="p">))</span> 

<span class="c1"># Create an xarray DataArray for the EOF pattern with lat/lon coordinates</span>
    <span class="n">eof_da</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
        <span class="n">EOF</span><span class="p">,</span>
        <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">precip</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">precip</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]},</span>
        <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">]))</span>
    <span class="n">pc_da</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">E</span><span class="p">[:,</span><span class="n">ieof</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">precip</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]},</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s plot the EOF and PC time series to see what they look like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> <span class="c1"># removed  subplot_kw={&#39;projection&#39;: ccrs.PlateCarree()}</span>

<span class="c1"># 11. Plot the first EOF pattern (top panel)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span> <span class="c1"># added projection here</span>
<span class="n">eof_da</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;First EOF Pattern&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">BORDERS</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># 12. Plot the first PC time series (bottom panel)</span>
<span class="n">pc_da</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;First PC Time Series&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># Adjust layout to prevent overlapping titles/labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;/Users/tompkins/Downloads/eof_analysis_plot.jpg&#39;</span><span class="p">)</span> <span class="c1">#save the figure</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/96e757cf14c7a157a6d4d3a93ae64539dccad46f2e1fb7ae02d5bd6c6338a6fb.png" src="../../_images/96e757cf14c7a157a6d4d3a93ae64539dccad46f2e1fb7ae02d5bd6c6338a6fb.png" />
</div>
</div>
</section>
<section id="presenting-eofs-pcs">
<h2>Presenting EOFs/PCs<a class="headerlink" href="#presenting-eofs-pcs" title="Permalink to this heading">#</a></h2>
<p>The EOFs  and PC time series  that result from eigenanalysis of
are typically not in physical units. Recall that we have cosine-weighted our data and that the eigenvectors are unit vectors. Thus, there are a few post-processing steps that we need to go through in order to present our EOFs/PCs in a meaningful way.</p>
<p>Typically, we normalize the PC time series by dividing by its standard deviation. So, we simply need to standardize
to create an index.</p>
<p>We then project this normalized PC back onto the original anomaly data and divide by the length of
to get the EOF 1 structure in the original units i.e. the unweighted data.</p>
<p>Note that you can project  onto other variables as well. For example, in the case of the ENSO 3.4 index, we can project   onto the temperature or zonal wind onto the appropriate PC to see how these variables vary with ENSO.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pc_ts_std</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">pc</span> <span class="ow">in</span> <span class="n">pc_da</span><span class="p">:</span> 
   <span class="n">pc_ts_std</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pc</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pc</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">pc</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert the EOF into physical units</span>

<span class="c1"># first reshape original data from 3D to 2D</span>
<span class="n">precip_reshape</span> <span class="o">=</span> <span class="n">precip_anom_real</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ntime</span><span class="p">,</span><span class="n">nlon</span> <span class="o">*</span> <span class="n">nlat</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">EOF_phys</span><span class="o">=</span><span class="p">[]</span>

<span class="k">for</span> <span class="n">pc</span> <span class="ow">in</span> <span class="n">pc_ts_std</span><span class="p">:</span> 
    <span class="n">EOF_phys1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">pc</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">precip_reshape</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">ntime</span><span class="p">))</span>
    <span class="c1">#reshape back for plotting</span>
    <span class="n">EOF_phys1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">EOF_phys1</span><span class="p">,(</span><span class="n">nlat</span><span class="p">,</span><span class="n">nlon</span><span class="p">))</span>

    <span class="n">EOF_phys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
        <span class="n">EOF_phys1</span><span class="p">,</span>
        <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">precip</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">precip</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]},</span>
        <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Which eof do we want to plot (between 1 and neof)</span>
<span class="n">peof</span><span class="o">=</span><span class="mi">1</span>  <span class="c1"># peof=1 is the first EOF!!!</span>

<span class="k">if</span> <span class="n">peof</span><span class="o">&gt;</span><span class="n">neof</span><span class="p">:</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Bad plot eof, we only calculated neof=&quot;</span><span class="p">,</span><span class="n">neof</span><span class="p">,</span> <span class="s2">&quot; resetting to EOF=1&quot;</span><span class="p">)</span>
    <span class="n">peof</span><span class="o">=</span><span class="mi">1</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span> <span class="c1"># removed  subplot_kw={&#39;projection&#39;: ccrs.PlateCarree()}</span>


<span class="c1"># 11. Plot the first EOF pattern (top panel)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span> <span class="c1"># added projection here</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">EOF_phys</span><span class="p">[</span><span class="n">peof</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">4</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Pattern of EOF&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">peof</span><span class="p">))</span>  <span class="c1"># note peof=0 -&gt; EOF1</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">BORDERS</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># remove the original x axis</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># remove the original y axis</span>
 

  <span class="c1"># Add gridlines, labels, and ticks</span>
<span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">spine</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="n">spine</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># 12. Plot the first PC time series (bottom panel)</span>
<span class="n">pc_ts_std</span><span class="p">[</span><span class="n">peof</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PC&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">peof</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; Time Series&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Add a horizontal colorbar below the two subplots</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="p">[</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mm/day&#39;</span><span class="p">)</span>

<span class="c1">#plt.tight_layout()  # Adjust layout to prevent overlapping titles/labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;/Users/tompkins/Downloads/eof_analysis_plot.jpg&#39;</span><span class="p">)</span> <span class="c1">#save the figure</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/a0e04798f73d41432dd39012acb1ccde48b344deb12bbae714e9aed1d08ffc6d.png" src="../../_images/a0e04798f73d41432dd39012acb1ccde48b344deb12bbae714e9aed1d08ffc6d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_eof_pc_animation</span><span class="p">(</span><span class="n">eof_pattern</span><span class="p">,</span> <span class="n">pc_index</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;eof_animation.gif&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an animation of the EOF pattern and PC time series, with a moving marker</span>
<span class="sd">    on the time series plot.</span>

<span class="sd">    Args:</span>
<span class="sd">        eof_pattern (xarray.DataArray): The EOF pattern, with &#39;lat&#39; and &#39;lon&#39; coordinates.</span>
<span class="sd">        pc_index (xarray.DataArray): The PC time series.  Must have a &#39;time&#39; dimension.</span>
<span class="sd">        fps (int, optional): Frames per second of the animation. Defaults to 10.</span>
<span class="sd">        filename (str, optional): Name of the output gif file. Defaults to &quot;eof_animation.gif&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        matplotlib.animation.FuncAnimation: The animation object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ensure eof_pattern has &#39;lat&#39; and &#39;lon&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="s1">&#39;lat&#39;</span> <span class="ow">in</span> <span class="n">eof_pattern</span><span class="o">.</span><span class="n">coords</span> <span class="ow">and</span> <span class="s1">&#39;lon&#39;</span> <span class="ow">in</span> <span class="n">eof_pattern</span><span class="o">.</span><span class="n">coords</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The EOF pattern must have &#39;lat&#39; and &#39;lon&#39; coordinates.&quot;</span><span class="p">)</span>

    <span class="c1"># Ensure pc_index has &#39;time&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pc_index</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;PC index must have a &#39;time&#39; dimension.&quot;</span><span class="p">)</span>

    <span class="n">ntime</span> <span class="o">=</span> <span class="n">pc_index</span><span class="o">.</span><span class="n">size</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">pc_index</span><span class="o">.</span><span class="n">time</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                           <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()})</span>  <span class="c1">#projection for map</span>

    <span class="c1"># ---  Set up initial plots (outside update function) ---</span>
    <span class="c1"># EOF Pattern (top panel)</span>
    <span class="n">eof_plot</span> <span class="o">=</span> <span class="n">eof_pattern</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                                 <span class="n">vmin</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eof_pattern</span><span class="p">)),</span>
                                 <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eof_pattern</span><span class="p">)),</span>
                                 <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;EOF Pattern&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">BORDERS</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>  <span class="c1"># Remove x-ticks</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>  <span class="c1"># Remove y-ticks</span>
    <span class="k">for</span> <span class="n">spine</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">spine</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># PC Time Series (bottom panel)</span>
    <span class="n">pc_plot</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">pc_index</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">)</span>  <span class="c1"># Line plot</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PC Time Series&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">time_marker</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>  <span class="c1"># Marker for current time</span>

    <span class="c1"># Colorbar (add once, outside update)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">eof_plot</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="p">[</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>  <span class="c1"># same label as before</span>

    <span class="c1"># --- Update function for the animation ---</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the plots for each frame of the animation.</span>

<span class="sd">        Args:</span>
<span class="sd">            frame (int): The frame number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Update EOF plot</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">BORDERS</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;EOF Pattern, Time: </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">eof_plot</span> <span class="o">=</span> <span class="n">eof_pattern</span> <span class="o">*</span> <span class="n">pc_index</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span>
        <span class="n">eof_im</span> <span class="o">=</span> <span class="n">eof_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                                 <span class="n">vmin</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eof_pattern</span><span class="p">)),</span>
                                 <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eof_pattern</span><span class="p">)),</span>
                                 <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>  <span class="c1"># Remove x-ticks</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>  <span class="c1"># Remove y-ticks</span>
        <span class="k">for</span> <span class="n">spine</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">spine</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Update time marker position</span>
        <span class="n">time_marker</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">frame</span><span class="p">],</span> <span class="n">pc_index</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">frame</span><span class="p">])</span>

        <span class="k">return</span>  <span class="n">eof_im</span><span class="p">,</span> <span class="n">time_marker</span><span class="p">,</span>

    <span class="c1"># --- Create and save the animation ---</span>
    <span class="n">anim</span> <span class="o">=</span> <span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">update</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="n">ntime</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">1000</span> <span class="o">/</span> <span class="n">fps</span><span class="p">)</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">PillowWriter</span><span class="p">(</span><span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">)</span>
    <span class="n">anim</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">writer</span><span class="o">=</span><span class="n">writer</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Animation saved to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">anim</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">EOF_phys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Coordinates:
  * lat      (lat) float64 2kB -30.0 -29.75 -29.5 -29.25 ... 29.5 29.75 30.0
  * lon      (lon) float64 12kB -180.0 -179.8 -179.5 ... 179.2 179.5 179.8
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### BUGGED, I need to correct</span>

<span class="c1"># 2. Call the function to create and save the animation</span>
<span class="c1">#animation = create_eof_pc_animation(pc_ts_std[0], EOF_phys[0], fps=15, filename=&quot;my_eof_animation.gif&quot;)</span>

<span class="c1"># 3. Display the animation in the notebook</span>
<span class="c1">#plt.show()  # important to call plt.show()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="how-many-eofs-pcs-are-meaningful">
<h2>How many EOFs/PCs are meaningful?<a class="headerlink" href="#how-many-eofs-pcs-are-meaningful" title="Permalink to this heading">#</a></h2>
<p>Eigenanalysis of the covariance matrix will always give you an answer. The orthogonality of the eigenvectors/EOFs imposes a constraint on their pattern. Higher order EOFs are often trying to represent the noise while still being orthogonal to the other EOFs and, consequently, these patterns can become spurious statistical constructs rather than physically meaningful modes of variability.</p>
<p>Add note on North here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set up plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="c1"># plot fraction of variance explained by first 10 eigenvectors using the eigenvalues</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">LAM</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span><span class="o">+</span><span class="mf">1.</span><span class="p">),</span><span class="n">LAM</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">/</span> <span class="n">LAM</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span><span class="s1">&#39;.-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">10.5</span><span class="p">)</span>

<span class="c1"># define N*</span>
<span class="n">Nstar</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pc_ts_std</span><span class="p">)</span>

<span class="c1"># compute error bars using the North et al. &quot;rule of thumb&quot;</span>
<span class="n">eb</span> <span class="o">=</span> <span class="n">LAM</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">/</span> <span class="n">LAM</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">Nstar</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">LAM</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span><span class="o">+</span><span class="mf">1.</span><span class="p">),</span><span class="n">LAM</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">/</span> <span class="n">LAM</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span><span class="n">yerr</span> <span class="o">=</span> <span class="n">eb</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">xerr</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">)</span>

<span class="c1"># add labels, title, etc.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Fraction of Variance Explained&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;EOFs&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Explained variability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/b0cd173e3e0425792eca7a9c5155a89785197da7d935b0a5a3e253af67a6488b.png" src="../../_images/b0cd173e3e0425792eca7a9c5155a89785197da7d935b0a5a3e253af67a6488b.png" />
</div>
</div>
</section>
<section id="multivariate-eof-analysis">
<h2>Multivariate EOF analysis<a class="headerlink" href="#multivariate-eof-analysis" title="Permalink to this heading">#</a></h2>
<p>We will not cover it here, but it is straightforward to extend this technique to multivariate EOF analysis, that is, analysis of spatial co-variability between fields.  An example of this is the use of VP200, OLR and winds together to define an index for the Madden Julian Oscillation (MJO), (REFERENCE HERE).</p>
<p>Usually, in order to conduct a multivariate EOF analysis, of say, <span class="math notranslate nohighlight">\(nvar\)</span> variables, the variables are lined up in a single vector in the spatial dimension, that is, the 2D matrix <span class="math notranslate nohighlight">\(X\)</span> we analysis will have dimensions [ntime,nvar x nlon x nlat]. In practise, with multivariate EOF analysis it is necessary to normalize all variables to prevent the variable with the largest <em>absolute</em> values from dominating the variance. The scaling is reinserted when projecting the PCs back onto the original data as in the final steps above.</p>
</section>
<section id="caveat-on-modes">
<h2>Caveat on modes<a class="headerlink" href="#caveat-on-modes" title="Permalink to this heading">#</a></h2>
<p>A finally, a caveat!  While it is often apparent and tempting to conclude that the leading eigenvector(s) of variability is/are associated with natural modes of variability in the atmospheric system (it has been applied variously to seasonality, ENSO, MJO, PDO, NAO, AMOC,  etc…) one does have to make this jump with caution!  Recall that PCA is nothing more than a statistical technique and sometimes this association can be misleading.</p>
<p>In order to improve this, some people use rotated EOFs, where the coordinate system is rotated to maximize the variance in the leading modes.  A commonly used method is the <a class="reference external" href="https://online.stat.psu.edu/stat505/lesson/12/12.11">varimax method</a>. This can lead to simpler leading modes that might be easier to interpret, but at the cost of losing orthogonality in the PCs (and sometimes also the EOFs).</p>
<p><strong>Further reading</strong>: For more on this caveat, take a look at this <a class="reference external" href="https://journals.ametsoc.org/view/journals/clim/15/2/1520-0442_2002_015_0216_acnoti_2.0.co_2.xml?alreadyAuthRedirecting">excellent paper by Dommenget and Latif (2002)</a> for further reading.</p>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Covariance Matrix (<span class="math notranslate nohighlight">\(C\)</span>)</strong>: In EOF/PCA, the covariance matrix <span class="math notranslate nohighlight">\(C\)</span> represents the relationships between different spatial points (or variables) in your data. A high covariance between two points means they tend to vary together.</p></li>
<li><p><strong>Eigenanalysis</strong>: This is a mathematical technique applied to the covariance matrix. It involves finding the eigenvectors and eigenvalues of <span class="math notranslate nohighlight">\(C\)</span>.</p></li>
<li><p><strong>Eigenvectors</strong>: These are special vectors that, when multiplied by the matrix <span class="math notranslate nohighlight">\(C\)</span>, only change in magnitude, not direction. In EOF/PCA, the eigenvectors represent the spatial patterns (EOFs) of variability in your data.</p></li>
<li><p><strong>Eigenvalues</strong>: These are the factors by which the eigenvectors are scaled when multiplied by C. In EOF/PCA, the eigenvalues represent the amount of variance in the data explained by each corresponding EOF.</p></li>
</ul>
<p>Eigenanalysis essentially <em>rotates the original coordinate system</em> (defined by your original spatial points) into a <em>new coordinate system</em> defined by the eigenvectors. In the new coordinate system, the covariance matrix becomes a diagonal matrix with non-zero values only on its main diagonal and zeros everywhere else.</p>
<p>Variance is along the diagonal: When the covariance matrix is diagonal, the values on the diagonal represent the variance of the data along each of the new axes (the eigenvectors). Because it’s diagonal, there’s no covariance between these new axes (they are orthogonal). This means the eigenvectors represent <em>independent patterns of variability</em>.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="exercises">
<h1>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading">#</a></h1>
<ol class="arabic simple">
<li><p>Examine a different field and see how the PCA analysis reveals something about dynamics. E.g. NAO (z500), individual monsoons (precip), IOD or ENSO (SST)</p></li>
<li><p>Investigate how to use CDO to calculate EOFs and PCs  - for this see the tips below…</p></li>
<li></li>
</ol>
<section id="eofs-in-cdo-climate-data-analysis">
<h2>EOFs  in CDO (climate data analysis)<a class="headerlink" href="#eofs-in-cdo-climate-data-analysis" title="Permalink to this heading">#</a></h2>
<p>As jupyter notebooks can only run one kernal, i.e. choice between bash and python then I can only illustrate here the method without implementation (you can of course use the cdo wrapper in python)</p>
<p>So here we go:</p>
<p>First we remove the mean from the input:</p>
<p><code class="docutils literal notranslate"><span class="pre">#!/bin</span> <span class="pre">bash</span></code>
<code class="docutils literal notranslate"><span class="pre">cdo</span> <span class="pre">sub</span> <span class="pre">input.nc</span> <span class="pre">-timmean</span> <span class="pre">input.nc</span> <span class="pre">anom.nc</span></code></p>
<p>Now we perform the EOF analysis, we ask for the first 5 EOFs (you can choose of course):</p>
<p><code class="docutils literal notranslate"><span class="pre">cdo</span> <span class="pre">eof,5</span> <span class="pre">anom.nc</span> <span class="pre">eigval.nc</span> <span class="pre">pattern.nc</span></code></p>
<p>Now we project the pattern onto the data to get the PCs, note that “pc” is a “stub”, CDO outputs a single file per PC, and thus produces <a class="reference external" href="http://pc00001.nc">pc00001.nc</a> <a class="reference external" href="http://pc00002.nc">pc00002.nc</a> …etc in this case etc (I’ve never understood why they don’t output a single file with a pc dimention index).</p>
<p><code class="docutils literal notranslate"><span class="pre">cdo</span> <span class="pre">eofcoeff</span> <span class="pre">pattern.nc</span> <span class="pre">anom.nc</span> <span class="pre">pc</span></code></p>
<p>This is how we get the explained variance, basically we use the eigenvalues divided by their sum.</p>
<p><code class="docutils literal notranslate"><span class="pre">cdo</span> <span class="pre">-div</span> <span class="pre">eigval.nc</span> <span class="pre">-timsum</span> <span class="pre">eigval.nc</span> <span class="pre">explvar.nc</span></code></p>
<p>You will notice that the EOF and PC magnitudes are not associated with sensible values (just as in the python example)
So we need to normalize the PC timeseries and project it back on the data to get the associated anomaly in field units.</p>
<p>Choose a PC:</p>
<p><code class="docutils literal notranslate"><span class="pre">pc=pc00000.nc</span></code></p>
<p>Normalize it</p>
<p><code class="docutils literal notranslate"><span class="pre">cdo</span> <span class="pre">div</span> <span class="pre">-sub</span> <span class="pre">$pc</span> <span class="pre">-timmean</span> <span class="pre">$pc</span> <span class="pre">-timstd</span> <span class="pre">$pc</span> <span class="pre">${pc???}_std.nc</span></code></p>
<p>Here in order to project it we need to calculate the covariance but that needs a file which is ntime,nlon,nlat, as CDO can not broadcast in space, only in time, so we use the enlarge function:</p>
<p><code class="docutils literal notranslate"><span class="pre">cdo</span> <span class="pre">enlarge,precip_anom.nc</span>&#160; <span class="pre">${pc???}_std.nc</span> <span class="pre">${pc???}_std_lg.nc</span></code></p>
<p>And now we do the projection</p>
<p><code class="docutils literal notranslate"><span class="pre">cdo</span> <span class="pre">timcovar</span> <span class="pre">precip_anom.nc</span> <span class="pre">${pc???}_std_lg.nc</span> <span class="pre">precip_eof.nc</span></code></p>
<p>And that’s it!</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "adriantompkins/climate-book.git",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda"
        },
        kernelOptions: {
            name: "conda",
            path: "./notebooks/part2_cda"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="climdata_FFT_analysis.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Introduction to DDT analysis</p>
      </div>
    </a>
    <a class="right-next"
       href="climdata_linear_stability_analysis.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Larvae-Vector System: Stability Analysis and Temperature Dependence</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">EOF analysis</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#first-a-few-notes-on-terminology">First, a few notes on terminology:</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#maximizing-the-resemblance-of-e-1-onto-x-eigenanalysis-of-c">Maximizing the resemblance of <span class="math notranslate nohighlight">\(e_1\)</span> onto X = Eigenanalysis of C!</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-points">Key Points:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-remove-the-mean">Step 1: Remove the mean</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-standardizing-the-data-optional">Step 2: Standardizing the data (optional)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-weighting-gridded-data">Step 3: Weighting gridded data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-convert-3d-array-to-2d-matrix">Step 4: Convert 3D array to 2D matrix</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-5-calculate-the-covariance-matrix">Step 5: Calculate the covariance matrix</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-6-perform-eigenanalysis-of-the-covariance-matrix">Step 6: Perform eigenanalysis of the covariance matrix</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#presenting-eofs-pcs">Presenting EOFs/PCs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-many-eofs-pcs-are-meaningful">How many EOFs/PCs are meaningful?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multivariate-eof-analysis">Multivariate EOF analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#caveat-on-modes">Caveat on modes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eofs-in-cdo-climate-data-analysis">EOFs  in CDO (climate data analysis)</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Adrian Tompkins
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>